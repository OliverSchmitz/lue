# DO NOT EDIT THIS FILE DIRECTLY!
# This file is generated by a script (generate_travis_config.py).

language: cpp

sudo: false

matrix:
    include:
        - compiler: gcc
          python: "2.7"
          addons:
              apt:
                  sources:
                      - ubuntu-toolchain-r-test
                  packages:
                      - gcc-4.9
                      - g++-4.9
          env:
              - TRAVIS_C_COMPILER=gcc-4.9 TRAVIS_CXX_COMPILER=g++-4.9 TRAVIS_LUE_CMAKE_ARGUMENTS="-DCMAKE_BUILD_TYPE=Release -DCMAKE_C_COMPILER=$TRAVIS_C_COMPILER -DCMAKE_CXX_COMPILER=$TRAVIS_CXX_COMPILER -DLUE_BUILD_CXX_API:BOOL=TRUE -DLUE_BUILD_UTILITIES:BOOL=TRUE"


# Install/update dependencies required by the installation of the
# requirements of the project.
# Travis-specific stuff.
before_install:
    - python --version

    # Install conda and some Python packages.
    - wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh;
    - bash miniconda.sh -b -p $HOME/miniconda
    - export PATH="$HOME/miniconda/bin:$PATH"
    - hash -r
    - conda config --set always_yes yes --set changeps1 no
    - conda update -q conda
    - conda info -a  # Useful for debugging any issues with conda
    # conda create -q -n test-environment python=$TRAVIS_PYTHON_VERSION numpy
    - conda create -q -n test-environment numpy
    - source activate test-environment
    # - python setup.py install


    # Root of software we installed.
    - mkdir local

    # Locations for temporary files.
    - mkdir tmp tmp/source tmp/build


    # Install a recent version of CMake. ---------------------------------------
    # ~/tmp
    - cd tmp
    - wget --no-check-certificate http://www.cmake.org/files/v3.2/cmake-3.2.3-Linux-x86_64.tar.gz
    # ~/local
    - cd ../local
    - tar zxf ../tmp/cmake-3.2.3-Linux-x86_64.tar.gz
    - export PATH=$PWD/cmake-3.2.3-Linux-x86_64/bin:$PATH
    - cd ..


    # Install additional software not provided by Travis.
    # ~/tmp/source
    - cd tmp/source
    - git clone --recursive https://github.com/geoneric/peacock.git
    # ~/tmp/build
    - cd ../build
    - mkdir peacock
    # ~/tmp/build/peacock
    - cd peacock
    - cmake --version
    - CXX=$TRAVIS_CXX_COMPILER cmake -Dpeacock_prefix=$TRAVIS_BUILD_DIR/local -Dbuild_docopt=true -Ddocopt_version=0.6.1 -Dbuild_hdf5=true -Dhdf5_version=1.8.14 -Dbuild_gdal=true -Dgdal_version=2.0.1 -Dbuild_pybind11=true -Dpybind11_version=2.0.1 -Dbuild_boost=true -Dboost_version=1.57.0 -Dboost_build_boost_filesystem=true -Dboost_build_boost_system=true -Dboost_build_boost_test=true $TRAVIS_BUILD_DIR/tmp/source/peacock
    - CXX=$TRAVIS_CXX_COMPILER cmake --build . --target all
    # ~
    - cd ../../..


# Install dependencies required by the project, similar to what a user would
# have to do.
# install:


# Commands which need to be executed before building the project.
# Travis-specific stuff.
# before_script:


# Build the project, similar to what a user would have to do.
script:
    - mkdir build
    - cd build
    - cmake -DPEACOCK_PREFIX:PATH=$TRAVIS_BUILD_DIR/local $TRAVIS_LUE_CMAKE_ARGUMENTS ..
    - cmake --build . --target all
    - if [[ $TRAVIS_LUE_CMAKE_ARGUMENTS == *"LUE_BUILD_TEST:BOOL=TRUE"* ]]; then cmake --build . --target test; fi


notifications:
    email:
        - k.dejong1@uu.nl

