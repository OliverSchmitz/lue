# DO NOT EDIT THIS FILE DIRECTLY!
# This file is generated by a script (generate_travis_config.py).

dist: trusty
sudo: false
language: cpp

matrix:
    include:
        - compiler: gcc
          python: "3.6"
          addons:
              apt:
                  sources:
                      - ubuntu-toolchain-r-test
                  packages:
                      - tree
                      - libhdf5-dev
                      - gcc-5
                      - libboost-all-dev
                      - g++-5
          env:
              - TRAVIS_C_COMPILER=gcc-5 TRAVIS_CXX_COMPILER=g++-5 TRAVIS_CXX_FLAGS="" TRAVIS_BUILD_TYPE=Release TRAVIS_LUE_CMAKE_ARGUMENTS="-DCMAKE_BUILD_TYPE=$TRAVIS_BUILD_TYPE -DCMAKE_C_COMPILER=$TRAVIS_C_COMPILER -DCMAKE_CXX_COMPILER=$TRAVIS_CXX_COMPILER -DCMAKE_CXX_FLAGS=$TRAVIS_CXX_FLAGS -DLUE_BUILD_TEST:BOOL=TRUE "
        - compiler: gcc
          python: "3.6"
          addons:
              apt:
                  sources:
                      - ubuntu-toolchain-r-test
                  packages:
                      - libhdf5-dev
                      - tree
                      - g++-6
                      - libboost-all-dev
                      - gcc-6
          env:
              - TRAVIS_C_COMPILER=gcc-6 TRAVIS_CXX_COMPILER=g++-6 TRAVIS_CXX_FLAGS="" TRAVIS_BUILD_TYPE=Release TRAVIS_LUE_CMAKE_ARGUMENTS="-DCMAKE_BUILD_TYPE=$TRAVIS_BUILD_TYPE -DCMAKE_C_COMPILER=$TRAVIS_C_COMPILER -DCMAKE_CXX_COMPILER=$TRAVIS_CXX_COMPILER -DCMAKE_CXX_FLAGS=$TRAVIS_CXX_FLAGS -DLUE_BUILD_TEST:BOOL=TRUE "


# Install/update dependencies required by the installation of the
# requirements of the project.
# Travis-specific stuff.
before_install:
    # /home/travis/build/pcraster/lue
    - python --version

    # Install conda and some Python packages.
    - wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh;
    - bash miniconda.sh -b -p $HOME/miniconda
    - export PATH="$HOME/miniconda/bin:$PATH"
    - hash -r
    - conda config --set always_yes yes --set changeps1 no
    - conda update -q conda
    - conda info -a  # Useful for debugging any issues with conda
    # conda create -q -n test-environment python=$TRAVIS_PYTHON_VERSION numpy
    - conda create -q -n test-environment numpy
    - source activate test-environment
    # - python setup.py install


    # Root of software we installed.
    - mkdir local

    # Locations for temporary files.
    - mkdir tmp tmp/source tmp/build


    # Install a recent version of CMake. ---------------------------------------
    # ~/tmp
    - cd tmp
    - wget --no-check-certificate http://www.cmake.org/files/v3.9/cmake-3.9.1-Linux-x86_64.tar.gz
    # ~/local
    - cd ../local
    - tar zxf ../tmp/cmake-3.9.1-Linux-x86_64.tar.gz
    - export PATH=$PWD/cmake-3.9.1-Linux-x86_64/bin:$PATH
    - cd ..


    # Install additional software not provided by Travis.
    # ~/tmp/source
    - cd tmp/source
    - git clone --recursive https://github.com/geoneric/peacock.git
    # ~/tmp/build
    - cd ../build
    - mkdir peacock
    # ~/tmp/build/peacock
    - cd peacock
    - cmake --version
    - CXX=$TRAVIS_CXX_COMPILER cmake -Dpeacock_prefix=$TRAVIS_BUILD_DIR/local -Dbuild_gdal=true -Dgdal_version=2.0.1 -Dbuild_docopt=true -Ddocopt_version=0.6.2 $TRAVIS_BUILD_DIR/tmp/source/peacock
    - CXX=$TRAVIS_CXX_COMPILER cmake --build . --target all
    # ~
    - cd ../../..


# Install dependencies required by the project, similar to what a user would
# have to do.
install:
    # /home/travis/build/pcraster/lue


# Commands which need to be executed before building the project.
# Travis-specific stuff.
before_script:
    # /home/travis/build/pcraster/lue
    - pip install conan
    - mkdir build
    - cd build
    # When building ourselves use:
    #     -s compiler=gcc compiler.version=7 -s build_type=$TRAVIS_BUILD_TYPE
    - conan remote add conan-community https://api.bintray.com/conan/conan-community/conan
    - conan install .. --setting compiler=`echo $TRAVIS_C_COMPILER | cut -d'-' -f1` --setting compiler.version=`echo $TRAVIS_C_COMPILER | cut -d'-' -f2` --build fmt
    - cd ..


# Build the project, similar to what a user would have to do.
script:
    # /home/travis/build/pcraster/lue
    - cd build
    - tree -d $TRAVIS_BUILD_DIR/local
    - cmake -DPEACOCK_PREFIX:PATH=$TRAVIS_BUILD_DIR/local $TRAVIS_LUE_CMAKE_ARGUMENTS ..
    - cmake --build . --target all
    - if [[ $TRAVIS_LUE_CMAKE_ARGUMENTS == *"LUE_BUILD_TEST:BOOL=TRUE"* ]]; then cmake --build . --target test; fi


notifications:
    email:
        - k.dejong1@uu.nl

